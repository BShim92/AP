<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Advantage Slot Quick Check</title>
  <style>
    :root{
      font-family:-apple-system,system-ui,Segoe UI,Roboto,Arial;
      color-scheme: light;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      background:#f6f7fb;
      color:#0b0f18;
      -webkit-tap-highlight-color: transparent;
    }

    /* ===== Top compact game switcher (tap-safe) ===== */
    .topbar{
      position:sticky; top:0; z-index:9999;
      background:rgba(246,247,251,.94);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(0,0,0,.08);
      padding:8px 10px 6px;
      pointer-events:auto;
    }
    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      align-items:center;
      justify-content:flex-start;
      max-width:980px;
      margin:0 auto;
      position:relative;
      z-index:10000;
      pointer-events:auto;
    }
    .chip{
      border:1px solid rgba(0,0,0,.12);
      background:#ffffff;
      border-radius:999px;
      padding:7px 11px;
      font-weight:850;
      font-size:12px;
      line-height:1;
      cursor:pointer;
      user-select:none;
      white-space:nowrap;
      box-shadow:0 1px 0 rgba(0,0,0,.03);
      touch-action: manipulation;
      -webkit-user-select:none;
    }
    .chip:active{ transform: translateY(1px); }
    .chip[aria-selected="true"]{
      border-color: rgba(0,0,0,.22);
      box-shadow: 0 6px 16px rgba(0,0,0,.08);
    }

    /* ===== Page container ===== */
    .wrap{
      max-width:980px;
      margin:0 auto;
      padding:10px;
    }
    .game{ display:none; padding-bottom: calc(18px + env(safe-area-inset-bottom)); }
    .game.active{ display:block; }

    /* ===== Light panels ===== */
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1.05fr;
      gap:10px;
      align-items:start;
    }
    @media (max-width: 720px){
      .grid2{ grid-template-columns: 1fr; }
    }

    .panel{
      border:1px solid rgba(0,0,0,.10);
      background:#ffffff;
      border-radius:14px;
      padding:10px;
      box-shadow: 0 10px 30px rgba(0,0,0,.06);
    }
    .panelTitle{
      font-weight:950;
      letter-spacing:.4px;
      font-size:11px;
      opacity:.7;
      margin:0 0 10px;
      text-transform:uppercase;
    }

    /* ===== Inputs ===== */
    .field{ display:flex; gap:8px; align-items:center; }
    .label{ font-weight:900; font-size:13px; white-space:nowrap; }
    .sub{ font-weight:800; font-size:11px; opacity:.65; }

    input[type="number"], input[type="text"], select{
      width:100%;
      border:1px solid rgba(0,0,0,.14);
      border-radius:12px;
      padding:12px 12px;
      font-size:16px;
      font-weight:900;
      background:#fff;
      color:#0b0f18;
      outline:none;
    }
    input::placeholder{ color: rgba(11,15,24,.35); font-weight:800; }

    /* ===== Result bar ===== */
    .result{
      border:1px solid rgba(0,0,0,.10);
      border-radius:14px;
      padding:12px 12px;
      font-weight:950;
      font-size:18px;
      text-align:center;
      user-select:none;
      background:#ffffff;
      color:#0b0f18;
    }
    .result.clickable{ cursor:pointer; }
    .result.clickable:active{ transform: translateY(1px); }

    .r-white{ background:#ffffff; }
    .r-red{ background:#ff5a5a; }
    .r-orange{ background:#ffb34d; }
    .r-yellow{ background:#ffe066; }
    .r-green{ background:#67d36b; }

    /* ===== Small helper buttons ===== */
    .miniBtns{
      display:flex;
      gap:8px;
      margin-top:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .miniBtn{
      border:1px solid rgba(0,0,0,.12);
      background:#fff;
      border-radius:12px;
      padding:10px 12px;
      font-size:13px;
      font-weight:950;
      cursor:pointer;
      user-select:none;
      box-shadow: 0 6px 16px rgba(0,0,0,.06);
      touch-action: manipulation;
    }
    .miniBtn:active{ transform: translateY(1px); }

    .hint{
      margin-top:10px;
      font-size:12px;
      line-height:1.25;
      opacity:.75;
    }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-weight:900; }

    /* ===== Per-game AP logic at bottom ===== */
    .logic{
      margin-top:12px;
      border-top:1px dashed rgba(0,0,0,.15);
      padding-top:10px;
      font-size:12px;
      line-height:1.25;
      opacity:.78;
    }
    .logic b{ opacity:1; }

    /* ===== Temple Falls row grid ===== */
    .tfRows{ display:flex; flex-direction:column; gap:10px; }
    .tfRow{
      display:grid;
      grid-template-columns: repeat(5, 1fr) 1fr;
      gap:8px;
      align-items:stretch;
    }
    .tfCell{
      border-radius:12px;
      border:1px solid rgba(0,0,0,.10);
      background:#d9f2ff;
      padding:6px;
      display:flex;
      align-items:flex-end;
      min-height:58px;
      transition: background 120ms ease;
    }
    .tfCell.rainbow{
      background: linear-gradient(90deg,#ff5a5a,#ffb34d,#ffe066,#67d36b,#59c6ff,#9b6bff,#ff5ad9);
    }
    /* ✅ bigger cell font + fits 4 digits comfortably */
    .tfIn{
      width:100%;
      border:1px solid rgba(0,0,0,.14);
      border-radius:10px;
      padding:10px 8px;
      font-size:16px;
      font-weight:950;
      background: rgba(255,255,255,.92);
      text-align:right;
      font-variant-numeric: tabular-nums;
    }
    /* ✅ row total bigger, NOT rounded */
    .tfTotal{
      border-radius:12px;
      border:1px solid rgba(0,0,0,.10);
      background:#f2f3f7;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:950;
      font-size:16px;
      min-height:58px;
      user-select:none;
      font-variant-numeric: tabular-nums;
    }

    /* Floating dot (Temple Falls) */
    .fab{
      position:fixed;
      right: 14px;
      bottom: calc(90px + env(safe-area-inset-bottom));
      z-index: 99999;
      pointer-events:auto;
    }
    .fab button{
      border:1px solid rgba(0,0,0,.14);
      background:#fff;
      border-radius:14px;
      padding:12px 14px;
      font-size:18px;
      font-weight:950;
      cursor:pointer;
      box-shadow: 0 10px 26px rgba(0,0,0,.12);
      touch-action: manipulation;
    }

    /* ===== Frankenstein grid ===== */
    .fGrid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:8px;
    }
    .fCell{
      position:relative;
      border-radius:12px;
      border:1px solid rgba(0,0,0,.10);
      min-height:68px;
      padding:28px 6px 6px;
      display:flex;
      align-items:flex-end;
      background:#eef2ff;
    }
    .fRed{ background:#ffe3e3; }
    .fBlue{ background:#e3f4ff; }
    .w{
      position:absolute;
      top:6px; left:6px;
      font-size:10px;
      font-weight:950;
      padding:2px 6px;
      border-radius:999px;
      background: rgba(255,255,255,.85);
      border:1px solid rgba(0,0,0,.10);
      pointer-events:none;
    }
    .fIn{
      width:100%;
      border:1px solid rgba(0,0,0,.14);
      border-radius:10px;
      padding:10px 10px;
      font-size:16px;
      font-weight:900;
      background: rgba(255,255,255,.90);
      text-align:right;
      font-variant-numeric: tabular-nums;
    }

    /* ===== Simple 3-field colored list (Regal) ===== */
    .vStack{ display:flex; flex-direction:column; gap:10px; }
    .colorRow{
      display:grid;
      grid-template-columns: 1fr 1.3fr;
      gap:10px;
      align-items:center;
      border:1px solid rgba(0,0,0,.10);
      border-radius:14px;
      padding:10px;
      background:#fff;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-weight:950;
      font-size:14px;
    }
    .dot{
      width:12px; height:12px; border-radius:999px;
      border:1px solid rgba(0,0,0,.10);
      display:inline-block;
    }
    .dot.yellow{ background:#ffe066; }
    .dot.green{ background:#67d36b; }
    .dot.purple{ background:#9b6bff; }

    /* ===== Golden Jungle columns row ===== */
    .gjRow{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap:8px;
    }
    .gjCell{
      border:1px solid rgba(0,0,0,.10);
      border-radius:14px;
      background:#fff;
      padding:8px;
    }
    .gjCell .label{
      font-size:11px;
      opacity:.65;
      margin-bottom:6px;
    }
    .gjMetrics{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:8px;
      margin-top:10px;
    }
    .metric{
      border:1px solid rgba(0,0,0,.10);
      border-radius:14px;
      background:#fff;
      padding:10px;
      text-align:center;
    }
    .metric .k{ font-size:11px; opacity:.65; font-weight:900; }
    .metric .v{ font-size:18px; font-weight:950; margin-top:6px; }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="chips" id="chips" role="tablist" aria-label="Game switcher">
      <button class="chip" type="button" role="tab" aria-selected="true"  data-game="frank">Frankenstein</button>
      <button class="chip" type="button" role="tab" aria-selected="false" data-game="temple">Temple Falls</button>
      <button class="chip" type="button" role="tab" aria-selected="false" data-game="regal">Regal Riches</button>
      <button class="chip" type="button" role="tab" aria-selected="false" data-game="ascend">Ascending / Stack Up</button>
      <button class="chip" type="button" role="tab" aria-selected="false" data-game="golden">Golden Jungle</button>
    </div>
  </div>

  <div class="wrap">

    <!-- ====================== Frankenstein ====================== -->
    <section id="game-frank" class="game active" aria-label="Frankenstein">
      <div class="grid2">
        <div class="panel">
          <div class="panelTitle">INPUTS</div>
          <div class="hint">
            Defaults are <b>empty</b>, but each empty field is treated as <span class="mono">1</span> in the total.
          </div>
          <div class="hint">Tap the total bar to reset.</div>
        </div>

        <div class="panel">
          <div class="panelTitle">GRID</div>

          <div class="fGrid" id="fGrid">
            <div class="fCell fRed" data-mult="0"><div class="w">0</div></div>

            <div class="fCell fRed" data-mult="0.4"><div class="w">0.4</div><input class="fIn" type="number" inputmode="decimal" step="any" /></div>
            <div class="fCell fRed" data-mult="1.7"><div class="w">1.7</div><input class="fIn" type="number" inputmode="decimal" step="any" /></div>

            <div class="fCell fBlue" data-mult="1.6"><div class="w">1.6</div><input class="fIn" type="number" inputmode="decimal" step="any" /></div>
            <div class="fCell fBlue" data-mult="2.4"><div class="w">2.4</div><input class="fIn" type="number" inputmode="decimal" step="any" /></div>
            <div class="fCell fBlue" data-mult="2.0"><div class="w">2.0</div><input class="fIn" type="number" inputmode="decimal" step="any" /></div>

            <div class="fCell fBlue" data-mult="1.5"><div class="w">1.5</div><input class="fIn" type="number" inputmode="decimal" step="any" /></div>
            <div class="fCell fBlue" data-mult="1.25"><div class="w">1.25</div><input class="fIn" type="number" inputmode="decimal" step="any" /></div>
            <div class="fCell fBlue" data-mult="0.75"><div class="w">0.75</div><input class="fIn" type="number" inputmode="decimal" step="any" /></div>

            <div class="fCell fBlue" data-mult="0.75"><div class="w">0.75</div><input class="fIn" type="number" inputmode="decimal" step="any" /></div>
            <div class="fCell fBlue" data-mult="0.8"><div class="w">0.8</div><input class="fIn" type="number" inputmode="decimal" step="any" /></div>
            <div class="fCell fBlue" data-mult="0.4"><div class="w">0.4</div><input class="fIn" type="number" inputmode="decimal" step="any" /></div>
          </div>

          <div style="margin-top:10px;">
            <!-- ✅ clickable reset -->
            <div id="fResult" class="result r-white clickable" title="Tap to reset">0.00</div>
          </div>

          <div class="logic">
            <b>AP logic:</b> Weighted total (cell × multiplier). Bands: red &lt; 17, orange &lt; 17.5, yellow &lt; 18, green ≥ 18.
            Empty cells are treated as <span class="mono">1</span>.
          </div>
        </div>
      </div>
    </section>

    <!-- ====================== Temple Falls ====================== -->
    <section id="game-temple" class="game" aria-label="Temple Falls Jungle Adventure">
      <div class="grid2">
        <div class="panel">
          <div class="panelTitle">SETUP</div>
          <div class="field"><div class="label">Bet size <span class="sub">(required)</span></div></div>
          <div style="margin-top:8px;"><input id="tfBet" type="number" inputmode="decimal" step="any" placeholder="e.g., 8.80" /></div>

          <div class="miniBtns">
            <button class="miniBtn" type="button" id="tfAddRow">+ Row (top)</button>
            <button class="miniBtn" type="button" id="tfDot">Insert “.”</button>
          </div>

          <div class="hint">
            Empty cell = <span class="mono">1</span>. “.” = <span class="mono">38</span>. Numbers = (number ÷ bet).
            Top-added rows don’t count in the bottom total.
          </div>
          <div class="hint">Tap the total bar to reset.</div>
        </div>

        <div class="panel">
          <div class="panelTitle">GRID</div>
          <div id="tfRows" class="tfRows"></div>

          <div style="margin-top:10px;">
            <!-- ✅ NOT a reset button anymore -->
            <div id="tfResult" class="result r-white">0.00</div>

            <div class="logic">
              <b>AP logic:</b> Bottom total sums the 2 base rows only. Cell value: empty→1, “.”→38, number→(number ÷ bet).
              Bands: red &lt; 50, orange &lt; 60, green ≥ 60.
            </div>
          </div>
        </div>
      </div>

      <div class="fab"><button type="button" id="tfDotFab">.</button></div>
    </section>

    <!-- ====================== Regal Riches ====================== -->
    <section id="game-regal" class="game" aria-label="Regal Riches">
      <div class="grid2">
        <div class="panel">
          <div class="panelTitle">INPUTS</div>
          <div class="vStack">
            <div class="colorRow"><div class="pill"><span class="dot yellow"></span> Yellow</div><input id="rrYellow" type="number" inputmode="numeric" step="1" /></div>
            <div class="colorRow"><div class="pill"><span class="dot green"></span> Green</div><input id="rrGreen" type="number" inputmode="numeric" step="1" /></div>
            <div class="colorRow"><div class="pill"><span class="dot purple"></span> Purple</div><input id="rrPurple" type="number" inputmode="numeric" step="1" /></div>
          </div>
        </div>

        <div class="panel">
          <div class="panelTitle">RESULT</div>
          <div id="rrResult" class="result r-white">Enter values</div>

          <div class="logic">
            <b>AP logic:</b>
            AP if any of:
            <span class="mono">(Y ≥ 115 AND G ≥ 85 AND P ≥ 60)</span>
            OR <span class="mono">(Y+G+P ≥ 210)</span>
            OR <span class="mono">at least 2</span> of:
            <span class="mono">Y ≥ 106</span>, <span class="mono">G ≥ 81</span>, <span class="mono">P ≥ 56</span>.
          </div>
        </div>
      </div>
    </section>

    <!-- ====================== Ascending Fortunes / Stack Up Pays ====================== -->
    <section id="game-ascend" class="game" aria-label="Ascending Fortunes / Stack Up Pays">
      <div class="grid2">
        <div class="panel">
          <div class="panelTitle">INPUTS</div>
          <div class="vStack">
            <div class="colorRow"><div class="pill">Mega <span class="sub">(MHB 350)</span></div><input id="asMega" type="number" inputmode="numeric" step="1" /></div>
            <div class="colorRow"><div class="pill">Grand <span class="sub">(MHB 250)</span></div><input id="asGrand" type="number" inputmode="numeric" step="1" /></div>
            <div class="colorRow"><div class="pill">Major <span class="sub">(MHB 200)</span></div><input id="asMajor" type="number" inputmode="numeric" step="1" /></div>
            <div class="colorRow"><div class="pill">Minor <span class="sub">(MHB 100)</span></div><input id="asMinor" type="number" inputmode="numeric" step="1" /></div>
          </div>

          <div class="hint">
            Logic: “away” = (MHB − current). Hard: Major≤8 OR Grand≤12 OR Mega≤20.
            Soft: any 2 of Major≤10, Grand≤15, Mega≤26.
          </div>
        </div>

        <div class="panel">
          <div class="panelTitle">RESULT</div>
          <div id="asResult" class="result r-white">Enter values</div>
          <div class="hint" id="asDetail"></div>

          <div class="logic">
            <b>AP logic:</b> away = (MHB − current). Hard if any: Major≤8, Grand≤12, Mega≤20.
            Soft if at least 2 of: Major≤10, Grand≤15, Mega≤26.
          </div>
        </div>
      </div>
    </section>

    <!-- ====================== Golden Jungle ====================== -->
    <section id="game-golden" class="game" aria-label="Golden Jungle">
      <div class="grid2">
        <div class="panel">
          <div class="panelTitle">INPUTS</div>
          <div class="field"><div class="label">Red spin count</div></div>
          <div style="margin-top:8px;">
            <select id="gjSpin">
              <option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option>
              <option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option>
            </select>
          </div>

          <div class="hint">Columns default to <span class="mono">0</span> and only allow <span class="mono">0 / 1 / 2</span>.</div>
        </div>

        <div class="panel">
          <div class="panelTitle">COLUMNS</div>
          <div class="gjRow">
            <div class="gjCell"><div class="label">C1</div><select class="gjCol"><option value="0" selected>0</option><option value="1">1</option><option value="2">2</option></select></div>
            <div class="gjCell"><div class="label">C2</div><select class="gjCol"><option value="0" selected>0</option><option value="1">1</option><option value="2">2</option></select></div>
            <div class="gjCell"><div class="label">C3</div><select class="gjCol"><option value="0" selected>0</option><option value="1">1</option><option value="2">2</option></select></div>
            <div class="gjCell"><div class="label">C4</div><select class="gjCol"><option value="0" selected>0</option><option value="1">1</option><option value="2">2</option></select></div>
            <div class="gjCell"><div class="label">C5</div><select class="gjCol"><option value="0" selected>0</option><option value="1">1</option><option value="2">2</option></select></div>
          </div>

          <div class="gjMetrics">
            <div class="metric"><div class="k">Total</div><div class="v" id="gjTotal">0</div></div>
            <div class="metric"><div class="k"># of “2”</div><div class="v" id="gjTwos">0</div></div>
            <div class="metric"><div class="k">Required</div><div class="v" id="gjReq">—</div></div>
          </div>

          <div style="margin-top:10px;">
            <div id="gjResult" class="result r-white">—</div>
            <div class="hint" id="gjDetail"></div>

            <div class="logic">
              <b>AP logic:</b> Required total is derived from spin count with a small boost if any column is <span class="mono">2</span>.
              (If you want the exact Patreon threshold table hard-coded, give me the required totals by spin.)
            </div>
          </div>
        </div>
      </div>
    </section>

  </div><!-- /wrap -->

<script>
/* ====================== Shared helpers ====================== */
function nOrNull(v){
  const t = String(v ?? "").trim();
  if (t === "") return null;
  const n = Number(t);
  return Number.isFinite(n) ? n : null;
}
function clamp(x, lo, hi){ return Math.max(lo, Math.min(hi, x)); }
function setResult(el, text, cls){
  el.textContent = text;
  el.classList.remove("r-white","r-red","r-orange","r-yellow","r-green");
  el.classList.add(cls);
}

/* ====================== Game switching (tap-safe) ====================== */
const chipsHost = document.getElementById("chips");
const chipBtns = Array.from(document.querySelectorAll(".chip"));
const games = {
  frank: document.getElementById("game-frank"),
  temple: document.getElementById("game-temple"),
  regal: document.getElementById("game-regal"),
  ascend: document.getElementById("game-ascend"),
  golden: document.getElementById("game-golden"),
};
function showGame(key){
  for (const k in games) games[k].classList.toggle("active", k === key);
  for (const c of chipBtns) c.setAttribute("aria-selected", c.dataset.game === key ? "true" : "false");
  window.scrollTo({ top: 0, behavior: "instant" });
}
function onChipActivate(e){
  const btn = e.target.closest(".chip");
  if (!btn) return;
  e.preventDefault?.();
  showGame(btn.dataset.game);
}
chipsHost.addEventListener("click", onChipActivate, { passive:false });
chipsHost.addEventListener("touchstart", onChipActivate, { passive:false });

/* ====================== Frankenstein (EMPTY => 1) ====================== */
(function(){
  const fCells = Array.from(document.querySelectorAll("#fGrid .fCell"));
  const fInputs = Array.from(document.querySelectorAll("#fGrid .fIn"));
  const fResult = document.getElementById("fResult");

  function band(total){
    if (total < 17) return "r-red";
    if (total < 17.5) return "r-orange";
    if (total < 18) return "r-yellow";
    return "r-green";
  }
  function cellVal(inp){
    const t = String(inp.value ?? "").trim();
    if (t === "") return 1;
    const n = Number(t);
    return Number.isFinite(n) ? n : 1;
  }
  function recalc(){
    let total = 0;
    for (const cell of fCells){
      const mult = Number(cell.dataset.mult || "0");
      const inp = cell.querySelector(".fIn");
      const v = inp ? cellVal(inp) : 0;
      total += v * mult;
    }
    setResult(fResult, total.toFixed(2), band(total));
  }
  function reset(){
    for (const inp of fInputs) inp.value = "";
    recalc();
    fInputs[0]?.focus();
  }

  fInputs.forEach(inp => {
    inp.addEventListener("input", recalc);
    inp.addEventListener("focus", ()=> setTimeout(()=> inp.select?.(), 0));
  });

  /* ✅ total bar acts as reset */
  fResult.addEventListener("click", reset);
  fResult.addEventListener("touchstart", (e)=>{ e.preventDefault(); reset(); }, { passive:false });

  recalc();
})();

/* ====================== Temple Falls (Bet + EMPTY => 1) ====================== */
(function(){
  const tfBet = document.getElementById("tfBet");
  const tfRows = document.getElementById("tfRows");
  const tfResult = document.getElementById("tfResult");
  const tfAddRow = document.getElementById("tfAddRow");
  const tfDot = document.getElementById("tfDot");
  const tfDotFab = document.getElementById("tfDotFab");

  const BASE_ROWS = 2;
  let lastFocused = null;

  function parseBet(){
    const n = nOrNull(tfBet.value);
    return (n && n > 0) ? n : null;
  }

  // EMPTY => 1, "." => 38, number => number/bet
  function tfCellValue(raw, bet){
    const s = String(raw ?? "").trim();
    if (s === "") return 1;
    if (s === ".") return 38;
    const n = Number(s);
    if (!Number.isFinite(n)) return 1;
    return n / bet;
  }

  function setCellColor(inp){
    const cell = inp.closest(".tfCell");
    const s = String(inp.value ?? "").trim();

    if (s === "") {
      cell.classList.remove("rainbow");
      cell.style.background = "#d9f2ff";
      return;
    }
    if (s.includes(".")) {
      cell.classList.add("rainbow");
      cell.style.background = "";
      return;
    }
    const n = Number(s);
    if (!Number.isFinite(n)) {
      cell.classList.remove("rainbow");
      cell.style.background = "#d9f2ff";
      return;
    }
    cell.classList.remove("rainbow");
    const v = clamp(n, 1, 200);
    const t = (v - 1) / 199;
    const light = 92 - t * 22;
    cell.style.background = `hsl(45 90% ${light}%)`;
  }

  function band(total){
    if (total < 50) return "r-red";
    if (total < 60) return "r-orange";
    return "r-green";
  }

  function makeRow(included){
    const row = document.createElement("div");
    row.className = "tfRow";
    row.dataset.included = included ? "true" : "false";

    for (let i=0;i<5;i++){
      const cell = document.createElement("div");
      cell.className = "tfCell";

      const inp = document.createElement("input");
      inp.className = "tfIn";
      inp.type = "text";
      inp.setAttribute("inputmode","decimal");
      inp.setAttribute("pattern","[0-9.]*");
      inp.autocorrect = "off";
      inp.spellcheck = false;

      cell.appendChild(inp);
      row.appendChild(cell);

      cell.addEventListener("click", (e)=>{ if (e.target!==inp) inp.focus(); });
      inp.addEventListener("focus", ()=>{ lastFocused = inp; setTimeout(()=> inp.select?.(), 0); });
      inp.addEventListener("input", recalc);
      inp.addEventListener("keydown", (e)=>{
        if (e.key === "Enter"){ e.preventDefault(); focusNext(inp); }
      });
    }

    const total = document.createElement("div");
    total.className = "tfTotal";
    total.textContent = "0.00";
    row.appendChild(total);
    return row;
  }

  function allRows(){ return Array.from(tfRows.querySelectorAll(".tfRow")); }
  function allInputs(){ return Array.from(tfRows.querySelectorAll(".tfIn")); }

  function focusNext(inp){
    const ins = allInputs();
    const idx = ins.indexOf(inp);
    if (idx >= 0 && idx < ins.length - 1) ins[idx+1].focus();
    else inp.blur();
  }

  function init(){
    tfRows.innerHTML = "";
    for (let r=0;r<BASE_ROWS;r++) tfRows.appendChild(makeRow(true));
    recalc();
  }

  function recalc(){
    const bet = parseBet();
    const rows = allRows();
    let bottomTotal = 0;

    for (const row of rows){
      const inputs = Array.from(row.querySelectorAll(".tfIn"));
      inputs.forEach(setCellColor);

      let rowSum = 0;

      if (!bet){
        for (const inp of inputs){
          const s = String(inp.value ?? "").trim();
          if (s === "") rowSum += 1;
          else if (s === ".") rowSum += 38;
          else rowSum += 0;
        }
      } else {
        for (const inp of inputs) rowSum += tfCellValue(inp.value, bet);
      }

      row.querySelector(".tfTotal").textContent = rowSum.toFixed(2);

      if (row.dataset.included === "true") bottomTotal += rowSum;
    }

    if (!bet && allInputs().every(i => String(i.value ?? "").trim() === "")){
      setResult(tfResult, "0.00", "r-white");
      return;
    }

    if (!bet){
      setResult(tfResult, bottomTotal.toFixed(2), "r-white");
      return;
    }

    setResult(tfResult, bottomTotal.toFixed(2), band(bottomTotal));
  }

  function reset(){
    tfBet.value = "";
    // remove added rows + clear base inputs
    init();
    tfBet.focus();
  }

  tfBet.addEventListener("input", recalc);

  tfAddRow.addEventListener("click", ()=>{
    const row = makeRow(false);
    tfRows.prepend(row);
    row.querySelector(".tfIn")?.focus();
    recalc();
  });

  function insertDot(){
    const ins = allInputs();
    if (!ins.length) return;
    let idx = lastFocused ? ins.indexOf(lastFocused) : -1;
    if (idx < 0) idx = 0;
    ins[idx].value = ".";
    recalc();
    focusNext(ins[idx]);
  }

  tfDot.addEventListener("click", insertDot);
  tfDotFab.addEventListener("click", insertDot);

  /* ✅ total bar IS a reset button */
  tfResult.classList.add("clickable");
  tfResult.title = "Tap to reset";
  tfResult.addEventListener("click", reset);
  tfResult.addEventListener("touchstart", (e)=>{ e.preventDefault(); reset(); }, { passive:false });

  init();
})();

/* ====================== Regal Riches ====================== */
(function(){
  const yEl = document.getElementById("rrYellow");
  const gEl = document.getElementById("rrGreen");
  const pEl = document.getElementById("rrPurple");
  const out = document.getElementById("rrResult");

  function recalc(){
    const Y = nOrNull(yEl.value);
    const G = nOrNull(gEl.value);
    const P = nOrNull(pEl.value);

    if (!Number.isFinite(Y) && !Number.isFinite(G) && !Number.isFinite(P)){
      setResult(out, "Enter values", "r-white");
      return;
    }

    const y = Number.isFinite(Y) ? Y : 0;
    const g = Number.isFinite(G) ? G : 0;
    const p = Number.isFinite(P) ? P : 0;

    const allHard = (y >= 115 && g >= 85 && p >= 60);
    const sumHard = (y + g + p >= 210);

    const softCount =
      (y >= 106 ? 1 : 0) +
      (g >= 81  ? 1 : 0) +
      (p >= 56  ? 1 : 0);

    const softTwo = (softCount >= 2);

    if (allHard || sumHard || softTwo){
      let msg = "AP ✅";
      if (allHard) msg = "AP ✅ (All hard met)";
      else if (sumHard) msg = "AP ✅ (Sum ≥ 210)";
      else msg = `AP ✅ (2 soft met)`;
      setResult(out, msg, "r-green");
      return;
    }

    setResult(out, "Not AP", "r-red");
  }

  [yEl,gEl,pEl].forEach(el => el.addEventListener("input", recalc));
  recalc();
})();

/* ====================== Ascending Fortunes / Stack Up Pays ====================== */
(function(){
  const megaEl  = document.getElementById("asMega");
  const grandEl = document.getElementById("asGrand");
  const majorEl = document.getElementById("asMajor");
  const minorEl = document.getElementById("asMinor");

  const out = document.getElementById("asResult");
  const detail = document.getElementById("asDetail");

  const MHB = { Mega: 350, Grand: 250, Major: 200, Minor: 100 };
  const HARD_AWAY = { Mega: 20, Grand: 12, Major: 8, Minor: 4 };
  const SOFT_AWAY = { Mega: 26, Grand: 15, Major: 10, Minor: 5 };

  function away(name, val){
    if (!Number.isFinite(val)) return null;
    return MHB[name] - val;
  }

  function recalc(){
    const v = {
      Mega:  nOrNull(megaEl.value),
      Grand: nOrNull(grandEl.value),
      Major: nOrNull(majorEl.value),
      Minor: nOrNull(minorEl.value),
    };

    const any = Object.values(v).some(n => Number.isFinite(n));
    if (!any){
      setResult(out, "Enter values", "r-white");
      detail.textContent = "";
      return;
    }

    const a = {
      Mega:  away("Mega", v.Mega),
      Grand: away("Grand", v.Grand),
      Major: away("Major", v.Major),
      Minor: away("Minor", v.Minor),
    };

    const hardList = ["Major","Grand","Mega"].filter(k => a[k] != null && a[k] <= HARD_AWAY[k]);
    if (hardList.length){
      const k = hardList[0];
      setResult(out, `AP ✅ (${k} ${a[k]} away)`, "r-green");
      detail.textContent = `Hard: Major≤8, Grand≤12, Mega≤20.`;
      return;
    }

    const softEligible = ["Major","Grand","Mega"].filter(k => a[k] != null && a[k] <= SOFT_AWAY[k]);
    if (softEligible.length >= 2){
      setResult(out, `Soft ✅ (${softEligible.slice(0,2).join(" + ")})`, "r-orange");
      detail.textContent = `Soft: Major≤10, Grand≤15, Mega≤26.`;
      return;
    }

    setResult(out, "Not in range", "r-red");
    const parts = ["Major","Grand","Mega"].map(k => (a[k]==null) ? `${k}: —` : `${k}: ${a[k]} away`);
    detail.textContent = parts.join(" • ");
  }

  [megaEl,grandEl,majorEl,minorEl].forEach(el => el.addEventListener("input", recalc));
  recalc();
})();

/* ====================== Golden Jungle ====================== */
(function(){
  const spinEl = document.getElementById("gjSpin");
  const colEls = Array.from(document.querySelectorAll(".gjCol"));
  const totalEl = document.getElementById("gjTotal");
  const twosEl = document.getElementById("gjTwos");
  const reqEl = document.getElementById("gjReq");
  const out = document.getElementById("gjResult");
  const detail = document.getElementById("gjDetail");

  const REQUIRED_BY_SPIN = [8,8,7,7,6,6,5,5,4,4];

  function recalc(){
    const spin = Number(spinEl.value);
    const vals = colEls.map(s => Number(s.value));
    const total = vals.reduce((a,b)=>a+b,0);
    const twos = vals.filter(v=>v===2).length;

    const baseReq = REQUIRED_BY_SPIN[clamp(spin,0,9)];
    const req = Math.max(0, baseReq - (twos >= 1 ? 1 : 0));

    totalEl.textContent = String(total);
    twosEl.textContent = String(twos);
    reqEl.textContent = String(req);

    if (total >= req){
      setResult(out, "AP ✅", "r-green");
      detail.textContent = `Total ${total} ≥ Required ${req} (spin ${spin}${twos?`, ${twos} two(s)`:``}).`;
    } else {
      setResult(out, "Not in range", "r-red");
      detail.textContent = `Need ${req - total} more (Required ${req}, spin ${spin}${twos?`, ${twos} two(s)`:``}).`;
    }
  }

  spinEl.addEventListener("change", recalc);
  colEls.forEach(el => el.addEventListener("change", recalc));
  recalc();
})();
</script>
</body>
</html>
