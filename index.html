<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>AP Floor Check — Slot Calculators</title>
  <style>
    :root{
      font-family:-apple-system,system-ui,Segoe UI,Roboto,Arial;
      --bg:#0b0f14;
      --panel:#101722;
      --panel2:#0f1620;
      --stroke:rgba(255,255,255,.10);
      --stroke2:rgba(255,255,255,.14);
      --text:#f2f6ff;
      --muted:rgba(242,246,255,.65);
      --good:#25d366;
      --bad:#ff5a5a;
      --warn:#ffb34d;

      --y:#ffe066;
      --g:#67d36b;
      --p:#b083ff;
      --b:#59c6ff;
      --r:#ff5a5a;
      --o:#ffb34d;

      --radius:14px;
      --pad:12px;
    }
    *{ box-sizing:border-box; }
    body{ margin:10px; background:var(--bg); color:var(--text); }
    .shell{ max-width:980px; margin:0 auto; }

    /* ---------- Top nav (floor-optimized) ---------- */
    .nav{
      position:sticky; top:0; z-index:50;
      background:linear-gradient(180deg, rgba(11,15,20,.98), rgba(11,15,20,.82));
      backdrop-filter: blur(10px);
      padding: 8px 0 10px;
    }
    .navRow{
      display:flex; gap:8px; align-items:center; flex-wrap:wrap;
    }

    .chipbar{ display:flex; gap:8px; flex-wrap:wrap; flex: 1; }
    .chip{
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);
      color:var(--text);
      border-radius:999px;
      padding:10px 12px;
      font-weight:900;
      font-size:13px;
      cursor:pointer;
      user-select:none;
      letter-spacing:.2px;
    }
    .chip.active{ border-color:rgba(89,198,255,.55); background:rgba(89,198,255,.14); }

    .btn{
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);
      color:var(--text);
      border-radius:999px;
      padding:10px 12px;
      font-weight:900;
      font-size:13px;
      cursor:pointer;
      user-select:none;
      white-space:nowrap;
    }
    .btn:active,.chip:active{ transform: translateY(1px); }

    .kpi{
      display:flex; gap:8px; align-items:center; width:100%;
      margin-top:8px;
    }
    .badge{
      flex:1;
      border:1px solid var(--stroke2);
      border-radius: var(--radius);
      padding: 12px 12px;
      background: rgba(255,255,255,.04);
      min-height: 52px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .badge .left{ display:flex; flex-direction:column; gap:2px; }
    .badge .title{ font-weight:1000; font-size:16px; line-height:1.05; }
    .badge .why{ font-size:12px; color:var(--muted); font-weight:800; line-height:1.1; }
    .pill{
      font-weight:1000;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke2);
      min-width: 106px;
      text-align:center;
      letter-spacing:.4px;
    }
    .pill.good{ background:rgba(37,211,102,.18); border-color:rgba(37,211,102,.45); color:var(--text); }
    .pill.bad{ background:rgba(255,90,90,.18); border-color:rgba(255,90,90,.45); color:var(--text); }
    .pill.neutral{ background:rgba(255,255,255,.05); }

    /* ---------- Panels / layout ---------- */
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    @media (max-width: 720px){
      .grid2{ grid-template-columns: 1fr; }
    }
    .panel{
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      background: rgba(255,255,255,.04);
      padding: var(--pad);
    }
    .panelTitle{
      font-weight:1000;
      font-size:13px;
      letter-spacing:.3px;
      color: var(--muted);
      margin: 0 0 8px;
    }
    .hint{
      margin-top:8px;
      font-size:12px;
      color:var(--muted);
      line-height:1.25;
      font-weight:700;
    }

    /* ---------- Inputs ---------- */
    .row{ display:flex; gap:8px; }
    .field{
      flex:1;
      border:1px solid var(--stroke);
      border-radius: 12px;
      padding: 10px;
      background: rgba(0,0,0,.18);
      min-height: 72px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
    }
    .label{
      font-weight:1000;
      font-size:12px;
      letter-spacing:.4px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .sub{
      font-size:11px;
      color:var(--muted);
      font-weight:800;
    }
    input, select{
      margin-top:8px;
      width:100%;
      font-size:22px;
      font-weight:1000;
      padding: 10px 10px;
      border-radius: 12px;
      border:1px solid var(--stroke2);
      color:var(--text);
      background: rgba(255,255,255,.06);
      outline:none;
    }
    input::placeholder{ color: rgba(242,246,255,.25); font-weight:900; }
    input:focus, select:focus{ border-color: rgba(89,198,255,.55); box-shadow: 0 0 0 3px rgba(89,198,255,.15); }

    .c-yellow{ border-color: rgba(255,224,102,.35); }
    .c-green { border-color: rgba(103,211,107,.35); }
    .c-purple{ border-color: rgba(176,131,255,.35); }
    .c-blue  { border-color: rgba(89,198,255,.35); }
    .c-red   { border-color: rgba(255,90,90,.35); }
    .c-orange{ border-color: rgba(255,179,77,.35); }

    .miniBtns{ display:flex; gap:8px; }
    .miniBtn{
      flex:1;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.05);
      color:var(--text);
      border-radius: 12px;
      padding: 10px 10px;
      font-weight:1000;
      font-size:13px;
      cursor:pointer;
      user-select:none;
    }
    .miniBtn:active{ transform: translateY(1px); }

    .collapse{
      margin-top:10px;
      border-top: 1px dashed var(--stroke);
      padding-top:10px;
    }
    .collapse summary{
      cursor:pointer;
      user-select:none;
      font-weight:1000;
      color: var(--muted);
      letter-spacing:.2px;
    }
    .collapse .hint{ margin-top:6px; }

    /* ---------- Frankenstein / Temple Falls: keep their vibe, but floor-friendly ---------- */
    .totalbar{
      border: 1px solid var(--stroke2);
      border-radius: var(--radius);
      padding: 12px 12px;
      text-align: center;
      font-weight: 1000;
      font-size: 26px;
      line-height: 1;
      user-select: none;
      cursor: pointer;
      color: #000;
      background: #fff;
    }
    .t-white{ background:#ffffff; }
    .t-red{ background:#ff5a5a; }
    .t-orange{ background:#ffb34d; }
    .t-yellow{ background:#ffe066; }
    .t-green{ background:#67d36b; }

    /* Frankenstein grid */
    #game-frank .fgrid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
    }
    #game-frank .fcell{
      position:relative;
      border-radius: var(--radius);
      border: 1px solid rgba(0,0,0,.10);
      min-height: 76px;
      padding: 34px 8px 10px;
      display:flex;
      align-items:flex-end;
      background:#d9f2ff;
    }
    #game-frank .fcell.r0{ background:#ffd6d6; }
    #game-frank .w{
      position:absolute;
      top:8px; left:8px;
      font-size: 11px;
      font-weight: 1000;
      background: rgba(255,255,255,.85);
      padding: 2px 8px;
      border-radius:999px;
      border:1px solid rgba(0,0,0,.10);
      color:#000;
      pointer-events:none;
    }
    #game-frank .fcell input{
      font-size: 18px;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,.16);
      background: rgba(255,255,255,.88);
      color:#000;
    }
    #game-frank .footer{ grid-column: 1 / -1; }

    /* Temple Falls */
    #game-temple .tfRow{
      display:grid;
      grid-template-columns: repeat(5, 1fr) 0.9fr;
      gap:10px;
      align-items:stretch;
    }
    #game-temple .tfCell{
      border-radius: var(--radius);
      border: 1px solid rgba(0,0,0,.10);
      min-height: 64px;
      padding: 8px;
      display:flex;
      align-items:flex-end;
      background:#d9f2ff;
      transition: background 120ms ease;
    }
    #game-temple .tfCell.rainbow{
      background: linear-gradient(90deg,#ff5a5a,#ffb34d,#ffe066,#67d36b,#59c6ff,#9b6bff,#ff5ad9);
    }
    #game-temple .tfCell input{
      font-size:18px;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,.16);
      background: rgba(255,255,255,.88);
      color:#000;
      font-weight: 1000;
    }
    #game-temple .tfTotal{
      border-radius: var(--radius);
      border: 1px solid rgba(0,0,0,.10);
      background:#f0f0f0;
      min-height: 64px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:1000;
      color:#000;
      font-size:16px;
      user-select:none;
    }
    .fab{
      position: fixed;
      right: 14px;
      bottom: calc(88px + env(safe-area-inset-bottom));
      z-index: 9999;
      display:flex;
      gap:8px;
    }
    .fab button{
      border: 1px solid var(--stroke2);
      background: rgba(255,255,255,.08);
      color: var(--text);
      border-radius: 16px;
      padding: 14px 16px;
      font-size: 20px;
      font-weight: 1000;
      cursor:pointer;
      user-select:none;
    }
    .fab button:active{ transform: translateY(1px); }

    /* Golden Jungle selector buttons */
    .seg{
      display:flex;
      gap:8px;
      margin-top:8px;
    }
    .seg button{
      flex:1;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.05);
      color:var(--text);
      border-radius: 12px;
      padding: 10px 10px;
      font-weight:1000;
      font-size:14px;
      cursor:pointer;
      user-select:none;
    }
    .seg button.active{
      border-color: rgba(89,198,255,.55);
      background: rgba(89,198,255,.14);
    }

    /* tiny monospace for computed */
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-weight:900; }
    .computed{
      white-space:pre-wrap;
      font-size:12px;
      color: var(--muted);
      line-height:1.25;
      user-select:text;
    }

    /* show/hide games */
    .game{ display:none; }
    .game.active{ display:block; }
  </style>
</head>

<body>
<div class="shell">

  <!-- Sticky header (tabs + global AP badge) -->
  <div class="nav">
    <div class="navRow">
      <div class="chipbar" id="chipbar"></div>
      <button class="btn" id="resetGameBtn" type="button">Reset game</button>
      <button class="btn" id="resetAllBtn" type="button">Reset all</button>
    </div>

    <div class="kpi">
      <div class="badge" id="globalBadge">
        <div class="left">
          <div class="title" id="globalTitle">—</div>
          <div class="why" id="globalWhy"></div>
        </div>
        <div class="pill neutral" id="globalPill">—</div>
      </div>
    </div>
  </div>

  <!-- ============================= -->
  <!-- GAME: Frankenstein -->
  <!-- ============================= -->
  <section id="game-frank" class="game active" aria-label="Frankenstein">
    <div class="grid2">
      <div class="panel">
        <div class="panelTitle">TOTAL (tap to reset)</div>
        <div id="frankTop" class="totalbar t-white">0.00</div>
        <div class="hint">Floor rule: <span class="mono">&lt;17</span> red, <span class="mono">&lt;17.5</span> orange, <span class="mono">&lt;18</span> yellow, <span class="mono">≥18</span> green.</div>
      </div>

      <div class="panel">
        <div class="panelTitle">GRID</div>
        <div class="fgrid" id="frankGrid">
          <div class="fcell r0" data-mult="0"><div class="w">0</div></div>

          <div class="fcell r0" data-mult="0.4"><div class="w">0.4</div>
            <input class="frankIn" value="" type="number" inputmode="decimal" step="any" placeholder="" />
          </div>
          <div class="fcell r0" data-mult="1.7"><div class="w">1.7</div>
            <input class="frankIn" value="" type="number" inputmode="decimal" step="any" placeholder="" />
          </div>

          <div class="fcell" data-mult="1.6"><div class="w">1.6</div>
            <input class="frankIn" value="" type="number" inputmode="decimal" step="any" placeholder="" />
          </div>
          <div class="fcell" data-mult="2.4"><div class="w">2.4</div>
            <input class="frankIn" value="" type="number" inputmode="decimal" step="any" placeholder="" />
          </div>
          <div class="fcell" data-mult="2.0"><div class="w">2.0</div>
            <input class="frankIn" value="" type="number" inputmode="decimal" step="any" placeholder="" />
          </div>

          <div class="fcell" data-mult="1.5"><div class="w">1.5</div>
            <input class="frankIn" value="" type="number" inputmode="decimal" step="any" placeholder="" />
          </div>
          <div class="fcell" data-mult="1.25"><div class="w">1.25</div>
            <input class="frankIn" value="" type="number" inputmode="decimal" step="any" placeholder="" />
          </div>
          <div class="fcell" data-mult="0.75"><div class="w">0.75</div>
            <input class="frankIn" value="" type="number" inputmode="decimal" step="any" placeholder="" />
          </div>

          <div class="fcell" data-mult="0.75"><div class="w">0.75</div>
            <input class="frankIn" value="" type="number" inputmode="decimal" step="any" placeholder="" />
          </div>
          <div class="fcell" data-mult="0.8"><div class="w">0.8</div>
            <input class="frankIn" value="" type="number" inputmode="decimal" step="any" placeholder="" />
          </div>
          <div class="fcell" data-mult="0.4"><div class="w">0.4</div>
            <input class="frankIn" value="" type="number" inputmode="decimal" step="any" placeholder="" />
          </div>

          <div id="frankBottom" class="totalbar t-white footer">0.00</div>
        </div>
      </div>
    </div>
  </section>

  <!-- ============================= -->
  <!-- GAME: Temple Falls -->
  <!-- ============================= -->
  <section id="game-temple" class="game" aria-label="Temple Falls">
    <div class="grid2">
      <div class="panel">
        <div class="panelTitle">SETUP</div>

        <div class="field c-blue" style="min-height:auto;">
          <div class="label">Bet size <span class="sub">(required)</span></div>
          <input id="tfBet" type="number" inputmode="decimal" step="any" placeholder="" />
        </div>

        <div class="miniBtns" style="margin-top:10px;">
          <button class="miniBtn" id="tfAddRow" type="button">+ Row (top)</button>
          <button class="miniBtn" id="tfDot" type="button">Insert “.”</button>
        </div>

        <div class="hint">Put <span class="mono">.</span> to represent a wheel. Top-added rows are excluded from bottom total.</div>
      </div>

      <div class="panel">
        <div class="panelTitle">GRID (2 base rows + added rows)</div>
        <div id="tfRows" style="display:flex;flex-direction:column;gap:10px;"></div>
        <div class="panelTitle" style="margin-top:10px;">TOTAL (tap to reset)</div>
        <div id="tfTotal" class="totalbar t-white">0.00</div>
      </div>
    </div>

    <div class="fab">
      <button type="button" id="tfDotFab">.</button>
    </div>
  </section>

  <!-- ============================= -->
  <!-- GAME: Regal Riches -->
  <!-- ============================= -->
  <section id="game-regal" class="game" aria-label="Regal Riches">
    <div class="grid2">
      <div class="panel">
        <div class="panelTitle">ENTER COUNTS (Top→Bottom: Yellow, Green, Purple)</div>

        <div class="field c-yellow">
          <div class="label">Yellow</div>
          <input id="rgY" type="number" inputmode="numeric" step="1" placeholder="" />
        </div>
        <div class="field c-green">
          <div class="label">Green</div>
          <input id="rgG" type="number" inputmode="numeric" step="1" placeholder="" />
        </div>
        <div class="field c-purple" style="margin-bottom:0;">
          <div class="label">Purple</div>
          <input id="rgP" type="number" inputmode="numeric" step="1" placeholder="" />
        </div>

        <details class="collapse">
          <summary>Advanced thresholds</summary>
          <div class="hint">Leave blank to use defaults. Triggers: GOLD (1-of-3), RED (2-of-3), SUM.</div>

          <div class="row" style="margin-top:10px;">
            <div class="field c-yellow">
              <div class="label">Yellow RED / GOLD</div>
              <div class="row" style="margin-top:8px;">
                <input id="rgTYR" type="number" step="1" placeholder="RED" />
                <input id="rgTYG" type="number" step="1" placeholder="GOLD" />
              </div>
            </div>
          </div>

          <div class="row">
            <div class="field c-green">
              <div class="label">Green RED / GOLD</div>
              <div class="row" style="margin-top:8px;">
                <input id="rgTGR" type="number" step="1" placeholder="RED" />
                <input id="rgTGG" type="number" step="1" placeholder="GOLD" />
              </div>
            </div>
          </div>

          <div class="row">
            <div class="field c-purple">
              <div class="label">Purple RED / GOLD</div>
              <div class="row" style="margin-top:8px;">
                <input id="rgTPR" type="number" step="1" placeholder="RED" />
                <input id="rgTPG" type="number" step="1" placeholder="GOLD" />
              </div>
            </div>
          </div>

          <div class="field">
            <div class="label">SUM min (Y+G+P)</div>
            <input id="rgTSUM" type="number" step="1" placeholder="" />
          </div>

          <div class="hint">Defaults: Y(RED106/GOLD115), G(81/85), P(56/60), SUM210.</div>
        </details>
      </div>

      <div class="panel">
        <div class="panelTitle">WHY</div>
        <div id="rgWhy" class="computed"></div>
      </div>
    </div>
  </section>

  <!-- ============================= -->
  <!-- GAME: Ascending Fortunes / Stack Up Pays -->
  <!-- ============================= -->
  <section id="game-ascending" class="game" aria-label="Ascending Fortunes / Stack Up Pays">
    <div class="grid2">
      <div class="panel">
        <div class="panelTitle">ENTER CURRENT COUNTS (no Mini)</div>

        <div class="field c-red">
          <div class="label">Mega <span class="sub">(current)</span></div>
          <input id="asMega" type="number" step="1" placeholder="" />
        </div>
        <div class="field c-orange">
          <div class="label">Grand <span class="sub">(current)</span></div>
          <input id="asGrand" type="number" step="1" placeholder="" />
        </div>
        <div class="field c-purple">
          <div class="label">Major <span class="sub">(current)</span></div>
          <input id="asMajor" type="number" step="1" placeholder="" />
        </div>
        <div class="field c-green" style="margin-bottom:0;">
          <div class="label">Minor <span class="sub">(current)</span></div>
          <input id="asMinor" type="number" step="1" placeholder="" />
        </div>

        <details class="collapse">
          <summary>Advanced (Must-Hit-By + thresholds)</summary>
          <div class="hint">Leave blanks to use defaults. Output uses “away” = max(0, MHB - current).</div>

          <div class="row" style="margin-top:10px;">
            <div class="field c-green">
              <div class="label">Minor MHB / strict-away</div>
              <div class="row" style="margin-top:8px;">
                <input id="asMhbMinor" type="number" step="1" placeholder="MHB" />
                <input id="asThrMinor" type="number" step="1" placeholder="away" />
              </div>
            </div>
          </div>

          <div class="row">
            <div class="field c-purple">
              <div class="label">Major MHB / strict-away</div>
              <div class="row" style="margin-top:8px;">
                <input id="asMhbMajor" type="number" step="1" placeholder="MHB" />
                <input id="asThrMajor" type="number" step="1" placeholder="away" />
              </div>
            </div>
          </div>

          <div class="row">
            <div class="field c-orange">
              <div class="label">Grand MHB / strict-away</div>
              <div class="row" style="margin-top:8px;">
                <input id="asMhbGrand" type="number" step="1" placeholder="MHB" />
                <input id="asThrGrand" type="number" step="1" placeholder="away" />
              </div>
            </div>
          </div>

          <div class="row">
            <div class="field c-red">
              <div class="label">Mega MHB / strict-away</div>
              <div class="row" style="margin-top:8px;">
                <input id="asMhbMega" type="number" step="1" placeholder="MHB" />
                <input id="asThrMega" type="number" step="1" placeholder="away" />
              </div>
            </div>
          </div>

          <div class="field">
            <div class="label">Soft rule (Major/Grand/Mega)</div>
            <div class="sub">soft-away = floor(strict-away × mult), need N-of-3</div>
            <div class="row" style="margin-top:8px;">
              <input id="asSoftMult" type="number" step="0.1" placeholder="mult" />
              <input id="asSoftNeed" type="number" step="1" placeholder="need" />
            </div>
          </div>

          <div class="hint">Defaults: Minor(150/4), Major(200/8), Grand(250/12), Mega(350/20), Soft(mult 1.3, need 2).</div>
        </details>
      </div>

      <div class="panel">
        <div class="panelTitle">WHY</div>
        <div id="asWhy" class="computed"></div>
      </div>
    </div>
  </section>

  <!-- ============================= -->
  <!-- GAME: Golden Jungle (2x) -->
  <!-- ============================= -->
  <section id="game-golden" class="game" aria-label="Golden Jungle (2x)">
    <div class="grid2">
      <div class="panel">
        <div class="panelTitle">ENTER</div>

        <div class="field c-red" style="min-height:auto;">
          <div class="label">Red spin count <span class="sub">(already happened)</span></div>
          <input id="gjSpin" type="number" step="1" placeholder="" />
        </div>

        <div class="panelTitle" style="margin-top:12px;">COLUMNS 1–5 (single row)</div>
        <div class="hint" style="margin-top:0;">Allowed: EMPTY, 0, 1, 2. Tap a value per column.</div>

        <div id="gjCols" style="display:flex;flex-direction:column;gap:10px;margin-top:10px;"></div>

        <details class="collapse">
          <summary>Rules quick view</summary>
          <div class="computed" id="gjRules"></div>
        </details>
      </div>

      <div class="panel">
        <div class="panelTitle">WHY</div>
        <div id="gjWhy" class="computed"></div>
      </div>
    </div>
  </section>

  <!-- ============================= -->
  <!-- GAME: Rocket Rumble -->
  <!-- ============================= -->
  <section id="game-rocket" class="game" aria-label="Rocket Rumble">
    <div class="grid2">
      <div class="panel">
        <div class="panelTitle">ENTER COUNTERS</div>

        <div class="field c-green">
          <div class="label">Green</div>
          <input id="rrGreen" type="number" step="1" placeholder="" />
        </div>
        <div class="field c-blue">
          <div class="label">Blue</div>
          <input id="rrBlue" type="number" step="1" placeholder="" />
        </div>
        <div class="field c-purple">
          <div class="label">Purple</div>
          <input id="rrPurple" type="number" step="1" placeholder="" />
        </div>
        <div class="field c-red" style="margin-bottom:0;">
          <div class="label">Red</div>
          <input id="rrRed" type="number" step="1" placeholder="" />
        </div>

        <details class="collapse">
          <summary>Advanced thresholds</summary>
          <div class="hint">Leave blanks to use defaults.</div>

          <div class="field c-green">
            <div class="label">Green strong / special</div>
            <div class="row" style="margin-top:8px;">
              <input id="rrTGreenStrong" type="number" step="1" placeholder="green≥" />
              <input id="rrTGreenSpecial" type="number" step="1" placeholder="green=" />
              <input id="rrTBlueSpecial" type="number" step="1" placeholder="blue=" />
            </div>
          </div>

          <div class="field c-purple">
            <div class="label">Purple playable / avoid</div>
            <div class="row" style="margin-top:8px;">
              <input id="rrTPurplePlayable" type="number" step="1" placeholder="purple≥" />
              <input id="rrTPurpleAvoid" type="number" step="1" placeholder="avoid=" />
            </div>
          </div>

          <div class="field c-red">
            <div class="label">Red info threshold</div>
            <input id="rrTRedInfo" type="number" step="1" placeholder="" />
          </div>

          <div class="field">
            <div class="label">Blue 13–14 handling</div>
            <div class="row" style="margin-top:8px;">
              <select id="rrBlueMode">
                <option value="ignore" selected>Default: ignore</option>
                <option value="weak">WEAK override</option>
              </select>
              <input id="rrTBlueWeakMin" type="number" step="1" placeholder="min" />
              <input id="rrTBlueWeakMax" type="number" step="1" placeholder="max" />
            </div>
          </div>

          <div class="hint">Defaults: Green≥17 OR (Green=16 & Blue=13); Purple≥32 (avoid=31); Red≥98 “safe-ish”; Blue 13–14 optional weak.</div>
        </details>
      </div>

      <div class="panel">
        <div class="panelTitle">WHY</div>
        <div id="rrWhy" class="computed"></div>
      </div>
    </div>
  </section>

</div>

<script>
(() => {
  /* =========================================================
     Floor UI goals implemented:
     - Big sticky AP badge (always visible)
     - One-tap game switching (chips)
     - Inputs: large, high-contrast, minimal labels
     - Advanced sections collapsed by default
     - Reset buttons always visible
     - All initial values empty
     - LocalStorage remembers per-game values (optional) so you can bounce between machines quickly
  ========================================================= */

  const $ = (id) => document.getElementById(id);
  const LS_UI = "ap_floor_ui_v1";

  const GAMES = [
    { id:"frank",   name:"Frankenstein" },
    { id:"temple",  name:"Temple Falls" },
    { id:"regal",   name:"Regal Riches" },
    { id:"ascending", name:"Ascending / Stack Up Pays" },
    { id:"golden",  name:"Golden Jungle (2x)" },
    { id:"rocket",  name:"Rocket Rumble" },
  ];

  function lsGet(key, fb=null){ try{ const r=localStorage.getItem(key); return r?JSON.parse(r):fb; }catch{return fb;} }
  function lsSet(key, val){ try{ localStorage.setItem(key, JSON.stringify(val)); }catch{} }
  function lsDel(key){ try{ localStorage.removeItem(key); }catch{} }

  /* ---------- Global badge ---------- */
  const globalTitle = $("globalTitle");
  const globalWhy = $("globalWhy");
  const globalPill = $("globalPill");

  function setGlobal(status, title, why){
    globalTitle.textContent = title || "—";
    globalWhy.textContent = why || "";
    globalPill.classList.remove("good","bad","neutral");
    if (status === "AP"){
      globalPill.classList.add("good");
      globalPill.textContent = "AP ✅";
    } else if (status === "NO"){
      globalPill.classList.add("bad");
      globalPill.textContent = "NO ❌";
    } else {
      globalPill.classList.add("neutral");
      globalPill.textContent = "—";
    }
  }

  /* ---------- Navigation ---------- */
  const chipbar = $("chipbar");

  function showGame(id){
    document.querySelectorAll(".game").forEach(s => s.classList.remove("active"));
    document.getElementById("game-"+id).classList.add("active");
    document.querySelectorAll(".chip").forEach(c => c.classList.toggle("active", c.dataset.game===id));
    lsSet(LS_UI, { game:id });

    // focus first input for speed
    setTimeout(() => {
      const sec = document.getElementById("game-"+id);
      const first = sec.querySelector("input,select");
      first?.focus?.();
    }, 50);

    evalActive(); // refresh badge with the active game
  }

  function initNav(){
    chipbar.innerHTML = "";
    for (const g of GAMES){
      const c = document.createElement("div");
      c.className = "chip";
      c.textContent = g.name;
      c.dataset.game = g.id;
      c.addEventListener("click", () => showGame(g.id));
      chipbar.appendChild(c);
    }
    const ui = lsGet(LS_UI, { game:"frank" });
    showGame(ui.game || "frank");
  }

  function activeGameId(){
    const active = document.querySelector(".game.active");
    if (!active) return "frank";
    return active.id.replace("game-","");
  }

  /* =========================================================
     Helpers
  ========================================================= */
  function numOrZero(v){
    const t = String(v ?? "").trim();
    if (t === "") return 0;
    const n = Number(t);
    return Number.isFinite(n) ? n : 0;
  }
  function intOrZero(v){
    const t = String(v ?? "").trim();
    if (t === "") return 0;
    const n = Math.floor(Number(t));
    return Number.isFinite(n) ? n : 0;
  }
  function isAllBlank(inputs){
    return inputs.every(el => String(el.value ?? "").trim() === "");
  }

  /* =========================================================
     Frankenstein
  ========================================================= */
  const LS_FRANK = "ap_floor_frank_v1";
  const frankTop = $("frankTop");
  const frankBottom = $("frankBottom");
  const frankInputs = Array.from(document.querySelectorAll(".frankIn"));

  function frankBand(total){
    if (total < 17) return "t-red";
    if (total < 17.5) return "t-orange";
    if (total < 18) return "t-yellow";
    return "t-green";
  }
  function frankRecalc(){
    const allBlank = isAllBlank(frankInputs);
    if (allBlank){
      frankTop.textContent = frankBottom.textContent = "0.00";
      frankTop.className = frankBottom.className = "totalbar t-white";
      setGlobal("—", "Frankenstein", "Enter values to compute.");
      return;
    }

    const cells = Array.from(document.querySelectorAll("#game-frank .fcell"));
    let total = 0;
    for (const cell of cells){
      const mult = Number(cell.dataset.mult || "0");
      const inp = cell.querySelector("input");
      const v = inp ? numOrZero(inp.value) : 0;
      total += v * mult;
    }

    const cls = frankBand(total);
    frankTop.textContent = frankBottom.textContent = total.toFixed(2);
    frankTop.className = "totalbar " + cls;
    frankBottom.className = "totalbar " + cls;

    // AP badge for active game
    if (activeGameId()==="frank"){
      const status = (total >= 18) ? "AP" : "NO";
      const why = (total >= 18)
        ? `Total ${total.toFixed(2)} ≥ 18.`
        : `Total ${total.toFixed(2)} below 18.`;
      setGlobal(status, "Frankenstein", why);
    }

    lsSet(LS_FRANK, frankInputs.map(i => i.value ?? ""));
  }
  function frankReset(){
    frankInputs.forEach(i => i.value = "");
    lsDel(LS_FRANK);
    frankRecalc();
    frankInputs[0]?.focus();
  }
  function frankRestore(){
    const saved = lsGet(LS_FRANK, null);
    if (!saved) return;
    saved.forEach((v, idx) => { if (frankInputs[idx]) frankInputs[idx].value = v; });
  }
  frankInputs.forEach(i => i.addEventListener("input", frankRecalc));
  frankTop.addEventListener("click", frankReset);
  frankBottom.addEventListener("click", frankReset);

  /* =========================================================
     Temple Falls
  ========================================================= */
  const LS_TF = "ap_floor_temple_v1";
  const tfBet = $("tfBet");
  const tfRows = $("tfRows");
  const tfTotal = $("tfTotal");
  const tfAddRow = $("tfAddRow");
  const tfDot = $("tfDot");
  const tfDotFab = $("tfDotFab");
  const TF_BASE_ROWS = 2;
  let tfLastFocused = null;

  function tfParseBet(){
    const t = String(tfBet.value ?? "").trim();
    if (t === "") return null;
    const n = Number(t);
    return Number.isFinite(n) && n > 0 ? n : null;
  }

  function tfCellValue(raw, bet){
    const s = String(raw ?? "").trim();
    if (s === "") return 0;
    if (s === ".") return 38;
    const n = Number(s);
    if (!Number.isFinite(n)) return 0;
    return n / bet;
  }

  function clamp(x, lo, hi){ return Math.max(lo, Math.min(hi, x)); }

  function tfSetCellColor(inp){
    const cell = inp.closest(".tfCell");
    const s = String(inp.value ?? "").trim();

    if (s === ""){
      cell.classList.remove("rainbow");
      cell.style.background = "#d9f2ff";
      return;
    }
    if (s.includes(".")){
      cell.classList.add("rainbow");
      cell.style.background = "";
      return;
    }
    const n = Number(s);
    if (!Number.isFinite(n)){
      cell.classList.remove("rainbow");
      cell.style.background = "#d9f2ff";
      return;
    }
    cell.classList.remove("rainbow");
    const v = clamp(n, 1, 200);
    const t = (v - 1) / 199;
    const light = 92 - t * 22;
    cell.style.background = `hsl(45 90% ${light}%)`;
  }

  function tfBand(total){
    if (total < 50) return "t-red";
    if (total < 60) return "t-orange";
    return "t-green";
  }

  function tfMakeRow(included){
    const row = document.createElement("div");
    row.className = "tfRow";
    row.dataset.included = included ? "true" : "false";

    for (let i=0;i<5;i++){
      const cell = document.createElement("div");
      cell.className = "tfCell";
      const inp = document.createElement("input");
      inp.className = "tfIn";
      inp.type = "text";
      inp.setAttribute("inputmode","decimal");
      inp.setAttribute("pattern","[0-9.]*");
      inp.autocorrect = "off";
      inp.spellcheck = false;
      inp.placeholder = "";

      cell.appendChild(inp);
      row.appendChild(cell);

      cell.addEventListener("click", (e)=>{ if (e.target!==inp) inp.focus(); });
      inp.addEventListener("focus", ()=>{ tfLastFocused = inp; });
      inp.addEventListener("input", tfRecalc);

      // Enter -> next input
      inp.addEventListener("keydown", (e)=>{
        if (e.key==="Enter"){
          e.preventDefault();
          tfFocusNext(inp);
        }
      });
    }

    const total = document.createElement("div");
    total.className = "tfTotal";
    total.textContent = "0.00";
    row.appendChild(total);
    return row;
  }

  function tfAllRows(){ return Array.from(tfRows.querySelectorAll(".tfRow")); }
  function tfAllInputs(){ return Array.from(tfRows.querySelectorAll(".tfIn")); }

  function tfFocusNext(inp){
    const ins = tfAllInputs();
    const idx = ins.indexOf(inp);
    if (idx >= 0 && idx < ins.length - 1) ins[idx+1].focus();
    else inp.blur();
  }

  function tfInit(){
    tfRows.innerHTML = "";
    for (let r=0;r<TF_BASE_ROWS;r++) tfRows.appendChild(tfMakeRow(true));
    tfRecalc();
  }

  function tfSave(){
    const state = {
      bet: String(tfBet.value ?? ""),
      rows: tfAllRows().map(r => ({
        included: r.dataset.included === "true",
        vals: Array.from(r.querySelectorAll(".tfIn")).map(i => String(i.value ?? ""))
      }))
    };
    lsSet(LS_TF, state);
  }

  function tfRestore(){
    const S = lsGet(LS_TF, null);
    if (!S){ tfInit(); return; }
    tfRows.innerHTML = "";
    tfBet.value = S.bet ?? "";
    if (Array.isArray(S.rows) && S.rows.length){
      for (const r of S.rows){
        const row = tfMakeRow(!!r.included);
        const ins = Array.from(row.querySelectorAll(".tfIn"));
        (r.vals || []).forEach((v,i)=>{ if (ins[i]) ins[i].value = v; });
        tfRows.appendChild(row);
      }
    } else {
      tfInit();
    }
    tfRecalc();
  }

  function tfRecalc(){
    const bet = tfParseBet();
    const rows = tfAllRows();

    let bottomTotal = 0;

    for (const row of rows){
      const ins = Array.from(row.querySelectorAll(".tfIn"));
      ins.forEach(tfSetCellColor);

      let rowSum = 0;
      if (bet){
        for (const inp of ins) rowSum += tfCellValue(inp.value, bet);
      }
      row.querySelector(".tfTotal").textContent = rowSum.toFixed(2);
      if (row.dataset.included==="true" && bet) bottomTotal += rowSum;
    }

    if (!bet || (String(tfBet.value ?? "").trim()==="" && isAllBlank(tfAllInputs()))){
      tfTotal.textContent = "0.00";
      tfTotal.className = "totalbar t-white";
      if (activeGameId()==="temple") setGlobal("—", "Temple Falls", "Enter bet + cells ('.' = wheel).");
      tfSave();
      return;
    }

    const cls = tfBand(bottomTotal);
    tfTotal.textContent = bottomTotal.toFixed(2);
    tfTotal.className = "totalbar " + cls;

    if (activeGameId()==="temple"){
      const status = (bottomTotal >= 60) ? "AP" : "NO";
      setGlobal(status, "Temple Falls", `Total ${bottomTotal.toFixed(2)} (${bottomTotal>=60?"≥60":"<60"}).`);
    }

    tfSave();
  }

  function tfReset(){
    tfBet.value = "";
    lsDel(LS_TF);
    tfInit();
    tfBet.focus();
  }

  tfAddRow.addEventListener("click", ()=>{
    const row = tfMakeRow(false);
    tfRows.prepend(row);
    row.querySelector(".tfIn")?.focus();
    tfRecalc();
  });

  function insertDot(){
    const ins = tfAllInputs();
    if (!ins.length) return;
    let idx = tfLastFocused ? ins.indexOf(tfLastFocused) : -1;
    if (idx < 0) idx = 0;
    ins[idx].value = ".";
    tfRecalc();
    tfFocusNext(ins[idx]);
  }
  tfDot.addEventListener("click", insertDot);
  tfDotFab.addEventListener("click", insertDot);

  tfBet.addEventListener("input", tfRecalc);
  tfTotal.addEventListener("click", tfReset);

  /* =========================================================
     Regal Riches
  ========================================================= */
  const LS_RG = "ap_floor_regal_v1";
  const REGAL_DEFAULTS = {
    yRed:106, yGold:115,
    gRed:81,  gGold:85,
    pRed:56,  pGold:60,
    sumMin:210
  };

  function rgRead(){
    const y = intOrZero($("rgY").value);
    const g = intOrZero($("rgG").value);
    const p = intOrZero($("rgP").value);

    const yRed  = intOrZero($("rgTYR").value) || REGAL_DEFAULTS.yRed;
    const yGold = intOrZero($("rgTYG").value) || REGAL_DEFAULTS.yGold;
    const gRed  = intOrZero($("rgTGR").value) || REGAL_DEFAULTS.gRed;
    const gGold = intOrZero($("rgTGG").value) || REGAL_DEFAULTS.gGold;
    const pRed  = intOrZero($("rgTPR").value) || REGAL_DEFAULTS.pRed;
    const pGold = intOrZero($("rgTPG").value) || REGAL_DEFAULTS.pGold;
    const sumMin= intOrZero($("rgTSUM").value)|| REGAL_DEFAULTS.sumMin;

    return { y,g,p, T:{yRed,yGold,gRed,gGold,pRed,pGold,sumMin} };
  }

  function rgEval(){
    const S = rgRead();
    const sum = S.y + S.g + S.p;

    const goldHits = [];
    if (S.y >= S.T.yGold) goldHits.push("Y");
    if (S.g >= S.T.gGold) goldHits.push("G");
    if (S.p >= S.T.pGold) goldHits.push("P");

    const redHits = [];
    if (S.y >= S.T.yRed) redHits.push("Y");
    if (S.g >= S.T.gRed) redHits.push("G");
    if (S.p >= S.T.pRed) redHits.push("P");

    let ap=false, why="";
    if (goldHits.length >= 1){
      ap=true; why=`GOLD: ${goldHits.join(",")} hit (need 1).`;
    } else if (redHits.length >= 2){
      ap=true; why=`RED: ${redHits.join(",")} hit (need 2).`;
    } else if (sum >= S.T.sumMin){
      ap=true; why=`SUM: ${sum} ≥ ${S.T.sumMin}.`;
    } else {
      ap=false; why=`No triggers. (sum ${sum}/${S.T.sumMin})`;
    }

    $("rgWhy").textContent =
      `Y=${S.y} (RED≥${S.T.yRed}, GOLD≥${S.T.yGold})\n` +
      `G=${S.g} (RED≥${S.T.gRed}, GOLD≥${S.T.gGold})\n` +
      `P=${S.p} (RED≥${S.T.pRed}, GOLD≥${S.T.pGold})\n` +
      `sum=${sum} (SUM≥${S.T.sumMin})\n` +
      `${ap ? "AP ✅ " : "NO ❌ "}${why}`;

    if (activeGameId()==="regal"){
      setGlobal(ap ? "AP" : "NO", "Regal Riches", why);
    }

    lsSet(LS_RG, {
      rgY:$("rgY").value, rgG:$("rgG").value, rgP:$("rgP").value,
      rgTYR:$("rgTYR").value, rgTYG:$("rgTYG").value, rgTGR:$("rgTGR").value, rgTGG:$("rgTGG").value,
      rgTPR:$("rgTPR").value, rgTPG:$("rgTPG").value, rgTSUM:$("rgTSUM").value
    });
  }

  function rgReset(){
    ["rgY","rgG","rgP","rgTYR","rgTYG","rgTGR","rgTGG","rgTPR","rgTPG","rgTSUM"].forEach(id => $(id).value="");
    lsDel(LS_RG);
    rgEval();
    $("rgY").focus();
  }

  function rgRestore(){
    const S = lsGet(LS_RG, null);
    if (!S) return;
    Object.keys(S).forEach(k => { if ($(k)) $(k).value = S[k] ?? ""; });
  }

  /* =========================================================
     Ascending
  ========================================================= */
  const LS_AS = "ap_floor_ascending_v1";
  const ASC_DEFAULTS = {
    mhbMinor:150, thrMinor:4,
    mhbMajor:200, thrMajor:8,
    mhbGrand:250, thrGrand:12,
    mhbMega:350,  thrMega:20,
    softMult:1.3, softNeed:2
  };

  function asRead(){
    const mega  = intOrZero($("asMega").value);
    const grand = intOrZero($("asGrand").value);
    const major = intOrZero($("asMajor").value);
    const minor = intOrZero($("asMinor").value);

    const mhbMinor = intOrZero($("asMhbMinor").value) || ASC_DEFAULTS.mhbMinor;
    const thrMinor = intOrZero($("asThrMinor").value) || ASC_DEFAULTS.thrMinor;

    const mhbMajor = intOrZero($("asMhbMajor").value) || ASC_DEFAULTS.mhbMajor;
    const thrMajor = intOrZero($("asThrMajor").value) || ASC_DEFAULTS.thrMajor;

    const mhbGrand = intOrZero($("asMhbGrand").value) || ASC_DEFAULTS.mhbGrand;
    const thrGrand = intOrZero($("asThrGrand").value) || ASC_DEFAULTS.thrGrand;

    const mhbMega  = intOrZero($("asMhbMega").value)  || ASC_DEFAULTS.mhbMega;
    const thrMega  = intOrZero($("asThrMega").value)  || ASC_DEFAULTS.thrMega;

    const softMultRaw = String($("asSoftMult").value ?? "").trim();
    const softNeedRaw = String($("asSoftNeed").value ?? "").trim();
    const softMult = softMultRaw==="" ? ASC_DEFAULTS.softMult : Number(softMultRaw);
    const softNeed = softNeedRaw==="" ? ASC_DEFAULTS.softNeed : Math.max(1, Math.floor(Number(softNeedRaw)));

    return {
      cur:{mega,grand,major,minor},
      mhb:{mega:mhbMega,grand:mhbGrand,major:mhbMajor,minor:mhbMinor},
      thr:{mega:thrMega,grand:thrGrand,major:thrMajor,minor:thrMinor},
      softMult: Number.isFinite(softMult) ? softMult : ASC_DEFAULTS.softMult,
      softNeed
    };
  }

  function away(mhb, cur){ return Math.max(0, Math.floor(mhb - cur)); }

  function asEval(){
    const S = asRead();
    const a = {
      mega:  away(S.mhb.mega,  S.cur.mega),
      grand: away(S.mhb.grand, S.cur.grand),
      major: away(S.mhb.major, S.cur.major),
      minor: away(S.mhb.minor, S.cur.minor),
    };

    const strictHits = [];
    if (a.minor <= S.thr.minor) strictHits.push(`Minor ${a.minor}≤${S.thr.minor}`);
    if (a.major <= S.thr.major) strictHits.push(`Major ${a.major}≤${S.thr.major}`);
    if (a.grand <= S.thr.grand) strictHits.push(`Grand ${a.grand}≤${S.thr.grand}`);
    if (a.mega  <= S.thr.mega)  strictHits.push(`Mega ${a.mega}≤${S.thr.mega}`);

    const softThr = {
      major: Math.floor(S.thr.major * S.softMult),
      grand: Math.floor(S.thr.grand * S.softMult),
      mega:  Math.floor(S.thr.mega  * S.softMult),
    };
    const softHits = [];
    if (a.major <= softThr.major) softHits.push(`Major ${a.major}≤${softThr.major}`);
    if (a.grand <= softThr.grand) softHits.push(`Grand ${a.grand}≤${softThr.grand}`);
    if (a.mega  <= softThr.mega)  softHits.push(`Mega ${a.mega}≤${softThr.mega}`);

    const softPass = softHits.length >= S.softNeed;

    let ap=false, why="";
    if (strictHits.length){
      ap=true; why = "Strict: " + strictHits.join(" | ");
    } else if (softPass){
      ap=true; why = `Soft ${S.softNeed}-of-3: ` + softHits.join(" | ");
    } else {
      ap=false; why = "No strict/soft trigger.";
    }

    $("asWhy").textContent =
      `away = max(0, MHB - current)\n` +
      `Mega : cur=${S.cur.mega}  MHB=${S.mhb.mega}  away=${a.mega}\n` +
      `Grand: cur=${S.cur.grand} MHB=${S.mhb.grand} away=${a.grand}\n` +
      `Major: cur=${S.cur.major} MHB=${S.mhb.major} away=${a.major}\n` +
      `Minor: cur=${S.cur.minor} MHB=${S.mhb.minor} away=${a.minor}\n` +
      `Strict thr: Mega≤${S.thr.mega}, Grand≤${S.thr.grand}, Major≤${S.thr.major}, Minor≤${S.thr.minor}\n` +
      `Soft: mult=${S.softMult} → Mega≤${softThr.mega}, Grand≤${softThr.grand}, Major≤${softThr.major} need ${S.softNeed}\n` +
      `${ap ? "AP ✅ " : "NO ❌ "}${why}`;

    if (activeGameId()==="ascending"){
      setGlobal(ap ? "AP" : "NO", "Ascending / Stack Up Pays", why);
    }

    lsSet(LS_AS, {
      asMega:$("asMega").value, asGrand:$("asGrand").value, asMajor:$("asMajor").value, asMinor:$("asMinor").value,
      asMhbMinor:$("asMhbMinor").value, asThrMinor:$("asThrMinor").value,
      asMhbMajor:$("asMhbMajor").value, asThrMajor:$("asThrMajor").value,
      asMhbGrand:$("asMhbGrand").value, asThrGrand:$("asThrGrand").value,
      asMhbMega:$("asMhbMega").value, asThrMega:$("asThrMega").value,
      asSoftMult:$("asSoftMult").value, asSoftNeed:$("asSoftNeed").value
    });
  }

  function asReset(){
    ["asMega","asGrand","asMajor","asMinor","asMhbMinor","asThrMinor","asMhbMajor","asThrMajor","asMhbGrand","asThrGrand","asMhbMega","asThrMega","asSoftMult","asSoftNeed"]
      .forEach(id => $(id).value="");
    lsDel(LS_AS);
    asEval();
    $("asMega").focus();
  }

  function asRestore(){
    const S = lsGet(LS_AS, null);
    if (!S) return;
    Object.keys(S).forEach(k => { if ($(k)) $(k).value = S[k] ?? ""; });
  }

  /* =========================================================
     Golden Jungle (2x)
  ========================================================= */
  const LS_GJ = "ap_floor_gj_v1";
  const GJ_STAGES = [1,2,4,6,8];

  function gjStageForSpin(spin){
    if (spin <= 1) return 1;
    for (const s of GJ_STAGES) if (spin <= s) return s;
    return 8;
  }

  const gjState = { c:[null,null,null,null,null] }; // null=EMPTY

  function gjRenderCols(){
    const host = $("gjCols");
    host.innerHTML = "";
    for (let i=0;i<5;i++){
      const col = document.createElement("div");
      col.className = "field c-blue";
      col.style.minHeight = "auto";

      const label = document.createElement("div");
      label.className = "label";
      label.textContent = `Column ${i+1}`;
      col.appendChild(label);

      const seg = document.createElement("div");
      seg.className = "seg";

      const options = [
        { v:null, t:"EMPTY" },
        { v:0, t:"0" },
        { v:1, t:"1" },
        { v:2, t:"2" },
      ];

      for (const opt of options){
        const b = document.createElement("button");
        b.type = "button";
        b.textContent = opt.t;
        b.className = (gjState.c[i] === opt.v) ? "active" : "";
        b.addEventListener("click", ()=>{
          gjState.c[i] = opt.v;
          gjRenderCols();
          gjEval();
        });
        seg.appendChild(b);
      }

      col.appendChild(seg);
      host.appendChild(col);
    }

    $("gjRules").textContent =
      `Stage mapping by red spins (already happened):\n` +
      `spin ≤1 → stage 1\nspin ≤2 → stage 2\nspin ≤4 → stage 4\nspin ≤6 → stage 6\nspin ≤8 → stage 8\nspin >8 → stage 8 (cap)\n\n` +
      `Values allowed: EMPTY,0,1,2 (EMPTY counts as 0).`;
  }

  function gjEval(){
    const spin = intOrZero($("gjSpin").value);

    const c = gjState.c.map(v => (v===null ? 0 : v));
    const [c1,c2,c3,c4,c5] = c;

    const total = c1+c2+c3+c4+c5;
    const sum13 = c1+c2+c3;

    const stage = gjStageForSpin(spin);

    const any2x14 = [c1,c2,c3,c4].some(v => v>=2);
    const any2x13 = [c1,c2,c3].some(v => v>=2);

    const s1 = () => ((c1+c2+c3+c4) >= 1);
    const s2 = () => (sum13 >= 1) || (c4 >= 2) || (c4 >= 1 && c5 >= 2);
    const s4 = () => (total >= 3) || any2x14;
    const s6 = () => (total >= 4) || (sum13 >= 3);
    const s8 = () => (
      (sum13 >= 3) ||
      (any2x13 && (c4 >= 1 || c5 >= 2)) ||
      (sum13 >= 2 && c4 >= 2) ||
      (sum13 >= 2 && c4 >= 1 && c5 >= 2) ||
      (sum13 >= 1 && c4 >= 2 && c5 >= 2)
    );

    let pass=false, why="";
    if (stage===1){ pass=s1(); why=pass ? "Stage 1: ≥1 on columns 1–4." : "Stage 1 failed."; }
    if (stage===2){ pass=s2(); why=pass ? "Stage 2 passed." : "Stage 2 failed."; }
    if (stage===4){ pass=s4(); why=pass ? "Stage 4 passed." : "Stage 4 failed."; }
    if (stage===6){ pass=s6(); why=pass ? "Stage 6 passed." : "Stage 6 failed."; }
    if (stage===8){ pass=s8(); why=pass ? "Stage 8 passed." : "Stage 8 failed."; }

    $("gjWhy").textContent =
      `spin=${spin} → stage=${stage}\n` +
      `c1=${c1} c2=${c2} c3=${c3} c4=${c4} c5=${c5}\n` +
      `total=${total}  sum(1–3)=${sum13}  any2x(1–4)=${any2x14}\n` +
      `${pass ? "AP ✅ " : "NO ❌ "}${why}`;

    if (activeGameId()==="golden"){
      setGlobal(pass ? "AP" : "NO", "Golden Jungle (2x)", `spin→stage ${stage}. ${why}`);
    }

    lsSet(LS_GJ, { spin: $("gjSpin").value, c: gjState.c });
  }

  function gjReset(){
    $("gjSpin").value = "";
    gjState.c = [null,null,null,null,null];
    lsDel(LS_GJ);
    gjRenderCols();
    gjEval();
    $("gjSpin").focus();
  }

  function gjRestore(){
    const S = lsGet(LS_GJ, null);
    if (!S) return;
    $("gjSpin").value = S.spin ?? "";
    if (Array.isArray(S.c) && S.c.length===5) gjState.c = S.c;
    gjRenderCols();
  }

  /* =========================================================
     Rocket Rumble
  ========================================================= */
  const LS_RR = "ap_floor_rr_v1";
  const RR_DEFAULTS = {
    greenStrong:17, greenSpecial:16, blueSpecial:13,
    purplePlayable:32, purpleAvoid:31, redInfo:98,
    blueMode:"ignore", blueWeakMin:13, blueWeakMax:14
  };

  function rrRead(){
    const green = intOrZero($("rrGreen").value);
    const blue  = intOrZero($("rrBlue").value);
    const purple= intOrZero($("rrPurple").value);
    const red   = intOrZero($("rrRed").value);

    const greenStrong = intOrZero($("rrTGreenStrong").value) || RR_DEFAULTS.greenStrong;
    const greenSpecial= intOrZero($("rrTGreenSpecial").value) || RR_DEFAULTS.greenSpecial;
    const blueSpecial = intOrZero($("rrTBlueSpecial").value) || RR_DEFAULTS.blueSpecial;

    const purplePlayable = intOrZero($("rrTPurplePlayable").value) || RR_DEFAULTS.purplePlayable;
    const purpleAvoid    = intOrZero($("rrTPurpleAvoid").value) || RR_DEFAULTS.purpleAvoid;

    const redInfo        = intOrZero($("rrTRedInfo").value) || RR_DEFAULTS.redInfo;

    const blueMode = $("rrBlueMode").value || RR_DEFAULTS.blueMode;
    const blueWeakMin = intOrZero($("rrTBlueWeakMin").value) || RR_DEFAULTS.blueWeakMin;
    const blueWeakMax = intOrZero($("rrTBlueWeakMax").value) || RR_DEFAULTS.blueWeakMax;

    return { green,blue,purple,red, T:{greenStrong,greenSpecial,blueSpecial,purplePlayable,purpleAvoid,redInfo,blueMode,blueWeakMin,blueWeakMax} };
  }

  function rrEval(){
    const S = rrRead();
    const warn = [];
    if (S.purple === S.T.purpleAvoid) warn.push(`Purple=${S.T.purpleAvoid} avoid.`);
    if (S.purple >= S.T.purplePlayable) warn.push("Purple trigger = long run.");
    if (S.red >= S.T.redInfo) warn.push(`Red=${S.red} ≥${S.T.redInfo} (mostly informational).`);

    let ap=false, why="";
    if (S.green >= S.T.greenStrong){
      ap=true; why=`Green ${S.green} ≥ ${S.T.greenStrong}.`;
    } else if (S.green === S.T.greenSpecial && S.blue === S.T.blueSpecial){
      ap=true; why=`Green ${S.green} = ${S.T.greenSpecial} AND Blue ${S.blue} = ${S.T.blueSpecial}.`;
    } else if (S.purple >= S.T.purplePlayable){
      ap=true; why=`Purple ${S.purple} ≥ ${S.T.purplePlayable}.`;
    } else {
      const blueInWeak = (S.blue >= S.T.blueWeakMin && S.blue <= S.T.blueWeakMax);
      if (S.T.blueMode==="weak" && blueInWeak){
        ap=true; why=`Blue ${S.blue} in [${S.T.blueWeakMin},${S.T.blueWeakMax}] (WEAK override).`;
        warn.push("Blue 13–14 is borderline (“or ignore”).");
      } else {
        ap=false; why="No Green trigger; Purple below threshold.";
      }
    }

    $("rrWhy").textContent =
      `green=${S.green} blue=${S.blue} purple=${S.purple} red=${S.red}\n` +
      `${ap ? "AP ✅ " : "NO ❌ "}${why}\n` +
      (warn.length ? `\nWarnings:\n- ${warn.join("\n- ")}` : "");

    if (activeGameId()==="rocket"){
      setGlobal(ap ? "AP" : "NO", "Rocket Rumble", why);
    }

    lsSet(LS_RR, {
      rrGreen:$("rrGreen").value, rrBlue:$("rrBlue").value, rrPurple:$("rrPurple").value, rrRed:$("rrRed").value,
      rrTGreenStrong:$("rrTGreenStrong").value, rrTGreenSpecial:$("rrTGreenSpecial").value, rrTBlueSpecial:$("rrTBlueSpecial").value,
      rrTPurplePlayable:$("rrTPurplePlayable").value, rrTPurpleAvoid:$("rrTPurpleAvoid").value, rrTRedInfo:$("rrTRedInfo").value,
      rrBlueMode:$("rrBlueMode").value, rrTBlueWeakMin:$("rrTBlueWeakMin").value, rrTBlueWeakMax:$("rrTBlueWeakMax").value
    });
  }

  function rrReset(){
    ["rrGreen","rrBlue","rrPurple","rrRed","rrTGreenStrong","rrTGreenSpecial","rrTBlueSpecial","rrTPurplePlayable","rrTPurpleAvoid","rrTRedInfo","rrTBlueWeakMin","rrTBlueWeakMax"]
      .forEach(id => $(id).value="");
    $("rrBlueMode").value = "ignore";
    lsDel(LS_RR);
    rrEval();
    $("rrGreen").focus();
  }

  function rrRestore(){
    const S = lsGet(LS_RR, null);
    if (!S) return;
    Object.keys(S).forEach(k => { if ($(k)) $(k).value = S[k] ?? ""; });
    if ($("rrBlueMode").value==="") $("rrBlueMode").value="ignore";
  }

  /* =========================================================
     Eval routing: only one badge (active game)
  ========================================================= */
  function evalActive(){
    const id = activeGameId();
    if (id==="frank") frankRecalc();
    if (id==="temple") tfRecalc();
    if (id==="regal") rgEval();
    if (id==="ascending") asEval();
    if (id==="golden") gjEval();
    if (id==="rocket") rrEval();
  }

  /* =========================================================
     Resets
  ========================================================= */
  $("resetGameBtn").addEventListener("click", () => {
    const id = activeGameId();
    if (id==="frank") frankReset();
    if (id==="temple") tfReset();
    if (id==="regal") rgReset();
    if (id==="ascending") asReset();
    if (id==="golden") gjReset();
    if (id==="rocket") rrReset();
  });

  $("resetAllBtn").addEventListener("click", () => {
    frankReset();
    tfReset();
    rgReset();
    asReset();
    gjReset();
    rrReset();
    lsDel(LS_UI);
    showGame("frank");
  });

  /* =========================================================
     Wire inputs (fast)
  ========================================================= */
  function onInput(ids, fn){
    ids.forEach(id => {
      const el = $(id);
      if (!el) return;
      el.addEventListener("input", fn);
      el.addEventListener("change", fn);
    });
  }

  onInput(["rgY","rgG","rgP","rgTYR","rgTYG","rgTGR","rgTGG","rgTPR","rgTPG","rgTSUM"], rgEval);
  onInput(["asMega","asGrand","asMajor","asMinor","asMhbMinor","asThrMinor","asMhbMajor","asThrMajor","asMhbGrand","asThrGrand","asMhbMega","asThrMega","asSoftMult","asSoftNeed"], asEval);
  onInput(["gjSpin"], gjEval);
  onInput(["rrGreen","rrBlue","rrPurple","rrRed","rrTGreenStrong","rrTGreenSpecial","rrTBlueSpecial","rrTPurplePlayable","rrTPurpleAvoid","rrTRedInfo","rrBlueMode","rrTBlueWeakMin","rrTBlueWeakMax"], rrEval);

  /* =========================================================
     Restore saved states (optional convenience)
  ========================================================= */
  frankRestore();
  tfRestore();
  rgRestore();
  asRestore();
  gjRestore();
  rrRestore();

  // after restore, compute each game once so computed panels fill
  frankRecalc();
  tfRecalc();
  rgEval();
  asEval();
  gjEval();
  rrEval();

  // build Golden Jungle columns UI (buttons)
  gjRenderCols();
  gjEval();

  // nav last so it shows the right badge for active
  initNav();
})();
</script>
</body>
</html>
